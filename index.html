<!DOCTYPE html>
<html>
<head>
<title>Pro Tracker Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Admin Login</h2>
<input type="password" id="pass">
<button onclick="login()">Login</button>

<div id="dash" style="display:none;">

<h1>Analytics</h1>

<p>Total Clicks: <span id="total"></span></p>
<p>Unique Visitors: <span id="unique"></span></p>

<canvas id="countryChart"></canvas>
<canvas id="deviceChart"></canvas>
<canvas id="dailyChart"></canvas>

<button onclick="exportCSV()">Export CSV</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = { /* same config */ };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const PASSWORD="Prem123";

window.login=function(){
  if(document.getElementById("pass").value===PASSWORD){
    document.getElementById("dash").style.display="block";
    load();
  }
}

function load(){

  onValue(ref(db,"clicks"),snap=>{
    if(!snap.exists()) return;

    let total=0, countries={}, devices={}, dates={};

    snap.forEach(link=>{
      link.forEach(c=>{
        total++;
        let v=c.val();
        countries[v.country]=(countries[v.country]||0)+1;
        devices[v.device]=(devices[v.device]||0)+1;
        dates[v.date]=(dates[v.date]||0)+1;
      });
    });

    document.getElementById("total").innerText=total;

    createChart("countryChart",countries);
    createChart("deviceChart",devices);
    createChart("dailyChart",dates);
  });

  onValue(ref(db,"unique"),snap=>{
    if(!snap.exists()) return;
    let count=0;
    snap.forEach(link=>{ count+=link.size; });
    document.getElementById("unique").innerText=count;
  });
}

function createChart(id,data){
  new Chart(document.getElementById(id),{
    type:'bar',
    data:{
      labels:Object.keys(data),
      datasets:[{data:Object.values(data)}]
    }
  });
}

window.exportCSV=function(){
  alert("CSV export ready (add blob logic if needed)");
}

</script>

</body>
</html>
