<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prime Tracker Admin</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
}
.header{
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  background:rgba(255,255,255,0.05);
}
.container{padding:20px;}
.card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
}
input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:none;
}
button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#3b82f6;
  color:white;
  cursor:pointer;
}
.linkBox{
  background:#334155;
  padding:10px;
  border-radius:8px;
  margin:10px 0;
}
.hidden{display:none;}
.center{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.loginBox{
  background:#1e293b;
  padding:30px;
  border-radius:15px;
  width:320px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen" class="center">
  <div class="loginBox">
    <h3>Admin Login</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="header">
    <h3>ðŸš€ Prime Tracker Dashboard</h3>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="container">

    <div class="card">
      <h4>Generate Tracking Link</h4>
      <input type="text" id="url" placeholder="Enter Target URL">
      <button onclick="createLink()">Generate</button>
      <div id="result"></div>
    </div>

    <div class="card">
      <h4>Generated Links History</h4>
      <div id="history"></div>
    </div>

    <div class="card">
      <h4>Link Analytics</h4>
      <div id="analyticsInfo">Select any link to view analytics</div>
      <canvas id="dateChart"></canvas>
    </div>

  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAk7OeIvh-D7NC_QKkQNMria4GxL5fT2ws",
  authDomain: "prime-f23e6.firebaseapp.com",
  databaseURL: "https://prime-f23e6-default-rtdb.firebaseio.com/",
  projectId: "prime-f23e6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

let chartInstance=null;

window.login=function(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;
  signInWithEmailAndPassword(auth,email,pass)
  .catch(e=>alert(e.message));
}

window.logout=function(){
  signOut(auth);
}

onAuthStateChanged(auth,(user)=>{
  if(user){
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    loadHistory();
  }else{
    document.getElementById("loginScreen").classList.remove("hidden");
    document.getElementById("dashboard").classList.add("hidden");
  }
});

function randomID(){
  return Math.random().toString(36).substring(2,8);
}

window.createLink=async function(){
  const url=document.getElementById("url").value;
  if(!url) return alert("Enter URL");

  const id=randomID();
  await set(ref(db,"links/"+id),{
    original:url,
    created:Date.now()
  });

  document.getElementById("result").innerHTML=
  `<div class="linkBox">
  https://creatorpoint.github.io/Prime_tracker/?id=${id}
  </div>`;
}

function loadHistory(){
  onValue(ref(db,"links"),(snapshot)=>{
    let html="";
    snapshot.forEach(link=>{
      const id=link.key;
      html+=`
      <div class="linkBox">
        <b>${id}</b><br>
        ${link.val().original}<br>
        <button onclick="viewAnalytics('${id}')">View Analytics</button>
      </div>`;
    });
    document.getElementById("history").innerHTML=html;
  });
}

window.viewAnalytics=function(id){
  onValue(ref(db,"clicks/"+id),(snapshot)=>{
    let total=0;
    let dateData={};

    if(snapshot.exists()){
      snapshot.forEach(click=>{
        total++;
        const v=click.val();
        dateData[v.date]=(dateData[v.date]||0)+1;
      });
    }

    document.getElementById("analyticsInfo").innerHTML=
    `<h3>Total Clicks: ${total}</h3>`;

    if(chartInstance){chartInstance.destroy();}

    chartInstance=new Chart(
      document.getElementById("dateChart"),
      {
        type:"line",
        data:{
          labels:Object.keys(dateData),
          datasets:[{
            label:"Clicks",
            data:Object.values(dateData),
            borderWidth:2
          }]
        }
      }
    );
  });
}

</script>
</body>
</html>
